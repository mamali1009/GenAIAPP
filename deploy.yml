name: Deploy Streamlit App to EC2
on:
 push:
   branches:
     - main  # Change if using another branch
jobs:
 deploy:
   runs-on: ubuntu-latest
   steps:
     - name: Checkout Repository
       uses: actions/checkout@v3
     - name: Set Up SSH Key
       run: |
         mkdir -p ~/.ssh
         echo "${{ secrets.EC2_KEY }}" > ~/.ssh/id_rsa
         chmod 600 ~/.ssh/id_rsa
         ssh-keyscan -H ${{ secrets.EC2_HOST }} >> ~/.ssh/known_hosts
     - name: Deploy Application
       run: |
         ssh ${{ secrets.EC2_USER }}@${{ secrets.EC2_HOST }} << 'EOF'
           cd /home/ec2-user/yourrepo  # Change to your repo path
           git pull origin main
           pip3 install -r requirements.txt  # Ensure dependencies are installed
           pkill -f streamlit  # Stop any running Streamlit process
           nohup streamlit run streamlit2.py --server.port 8501 --server.enableCORS false > streamlit.log 2>&1 &
         EOF
